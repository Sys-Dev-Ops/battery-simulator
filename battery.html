<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Battery Simulator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f2f2f2;
      text-align: center;
      padding-top: 50px;
    }
    svg {
      width: 300px;
      height: 100px;
    }
    #battery-text {
      font-size: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Battery Level</h1>

  <svg viewBox="0 0 200 50">
    <!-- Battery outline -->
    <rect x="1" y="10" width="180" height="30" fill="none" stroke="black" stroke-width="2"/>
    <!-- Battery tip -->
    <rect x="181" y="18" width="10" height="14" fill="black"/>
    <!-- Dynamic battery fill -->
    <rect id="battery-fill" x="2" y="11" width="176" height="28" fill="green"/>
    <!-- Text inside battery -->
    <text id="battery-text" x="90" y="31" fill="white" text-anchor="middle">100%</text>
  </svg>

  <script>
    async function updateBattery() {
      try {
        const response = await fetch("battery.txt", { cache: "no-store" });
        const text = await response.text();
        const percent = parseInt(text.trim());

        if (!isNaN(percent)) {
          const clamped = Math.max(0, Math.min(100, percent));
          const fillWidth = (clamped / 100) * 176;

          document.getElementById("battery-fill").setAttribute("width", fillWidth);
          document.getElementById("battery-text").textContent = `${clamped}%`;

          // Change fill color based on level
          const fillColor =
            clamped > 60 ? "green" :
            clamped > 30 ? "orange" : "red";

          document.getElementById("battery-fill").setAttribute("fill", fillColor);
        } else {
          console.error("Battery value is NaN:", text);
        }
      } catch (error) {
        console.error("Error reading battery:", error);
      }
    }

    // Initial call and update every 5 seconds
    updateBattery();
    setInterval(updateBattery, 5000);
  </script>
</body>
</html>